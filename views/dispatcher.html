<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>White Rose Taxi</title>
	<link rel="stylesheet" href="https://cdn.shopify.com/s/files/1/1490/7900/t/3/assets/simple.min.css" />
	<link rel="stylesheet" href="https://cdn.shopify.com/s/files/1/1490/7900/t/3/assets/jquery.mobile.icons.min.css" />
	<link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css" />
	<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>	
	<script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
	<script type="text/javascript" src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
	<style>
		[data-role=page]{height: 100% !important; position:relative !important;}
		[data-role=footer]{bottom:0; position:fixed !important; top: auto !important; width:100%;}
	</style>
	
	<script>
	
	function uid() {
		  // Math.random should be unique because of its seeding algorithm.
		  // Convert it to base 36 (numbers + letters), and grab the first 9 characters
		  // after the decimal.
		  return new Date().getTime() + '_' + Math.random().toString(36).substr(2, 9);
		}
		
		var uid = uid();
	
		try{
	
			var socket = io.connect('http://taxi-taximobile.7e14.starter-us-west-2.openshiftapps.com/dispatch');
			
			socket.emit('connect', 'New Dispatcher' + uid);											
			socket.on('connect',function(data){
				
				console.log('Connection Established!');
				$('#statusFooter').html('Connection Established!');				
			});
			
			socket.on('order',function(data){
				console.log(data);
				$('#statusFooter').html(data);
				var order = QueryStringToJSON(data);
				
				$('#orders').append(
					'<tr><td><a href="#waitTimeDiv" data-rel="popup" data-position-to="window">' + order.uid + '</a></td>' +
					'<td>' + order.name + '</td>' +
					'<td>' + order.phone + '</td>' +
					'<td>' + order.pickup + '</td>' +
					'<td>' + order.destination + '</td>' +
					'<th data-priority="1">Waiting</th>' +
					'</tr>'
				);
				
			});
			
			socket.on("disconnect", function () {
				console.log('Disconnected from Taxi Dispatch');
				$('#statusFooter').html('Disconnected from Taxi Dispatch');
				//alert('Disconnected from Taxi Dispatch');
			});
		}catch (error){			
				console.log('Cannot connect to Taxi Dispatch Server\n\n Error: ' + error);	
				$('#statusFooter').html('Cannot connect to Taxi Dispatch Server\n\n Error: ' + error);				
		}
		
		function QueryStringToJSON(data) {            
			var pairs = data.split('&');
			
			var result = {};
			pairs.forEach(function(pair) {
				pair = pair.split('=');
				result[pair[0]] = decodeURIComponent(pair[1] || '');
			});

			return JSON.parse(JSON.stringify(result));
		}
	
	</script>
	
</head>
<body>
	<!-- Home Page 1 //-->
	<div data-role="page" id="home">
		<div data-role="header" data-position="fixed">
			<h1>White Rose Taxi</h1>
		</div>
		<div data-role="header" data-id="home">
			<div data-role="navbar">
				<ul>
					<li><a class="ui-btn-active ui-state-persist" href="#home">Home</a></li>
					<li><a href="#jobs">Jobs</a></li>
					<li><a href="#dispatch">Dispatch</a></li>					
					<li><a href="#vehicles">Vehicles</a></li>
				</ul>
			</div><!-- /navbar -->
		</div>
		<div data-role="main" class="ui-content">
			<div style="text-align: center;">
				<img style="border-radius: 10px;" src="https://cdn.shopify.com/s/files/1/1490/7900/t/3/assets/WhiteRoseTaxiLogo.png" />
				<h1>White Rose Dispatcher App</h1>
			</div>
		</div>	
		<div data-role="footer" data-type="footer">
			<span style="padding: 2px;"> &nbsp;© 2018 White Rose Taxi</span>
			<span id="statusFooter" style="text-align: right; font-size: 10px;"></span>
		</div>
	</div>
	
	<!-- jobs //-->
	
	<div data-role="page" id="jobs">
		<div data-role="header" data-position="fixed">
			<h1>White Rose Taxi</h1>
		</div>
		<div data-role="header" data-id="jobs">
			<div data-role="navbar">
				<ul>
					<li><a href="#home">Home</a></li>
					<li><a class="ui-btn-active ui-state-persist" href="#jobs">Jobs</a></li>
					<li><a href="#dispatch">Dispatch</a></li>					
					<li><a href="#vehicles">Vehicles</a></li>
				</ul>
			</div><!-- /navbar -->
		</div>
		<div data-role="main" class="ui-content">
			<div style="text-align: center;">
				<h1>Jobs</h1>

				<table data-role="table" id="jobsTable" data-mode="columntoggle" data-column-btn-text="Filter" data-column-btn-theme="a" class="ui-shadow table-stroke">
				  <thead>
					<tr>
					<th class="label">
						ID
					  </th>
					  <th class="label">
						Name
					  </th>
					<th class="label">
						Phone
					</th>
					<th class="label">
						Pickup
					</th>
					<th class="label">
						Drop Off
					</th>
					<th class="label">
						Status
					</th>
					</tr>
				  </thead>
				  <tbody id="orders">
					
				  </tbody>
				</table>
				<!-- Popups for lightbox images -->
				<div id="waitTimeDiv" data-role="popup" data-overlay-theme="a" style="padding: 20px;">
					<label for="waitTime"><h2>Wait time in minutes?</h2></label>
					<input type="range" name="waitTime" id="waitTime" value="30" min="0" max="120" data-theme="b" />
					<br />
					<button style="background-color: green; color: white;"><strong>Accept</strong></button>
					<button style="background-color: red; color: white;"><strong>Cancel</strong></button>
				</div>

			</div>
		</div>	
		<div data-role="footer" data-type="footer">
			<span style="padding: 2px;"> &nbsp;© 2018 White Rose Taxi</span>
			<span id="statusFooter" style="text-align: right; font-size: 10px;"></span>
		</div>
	</div>
	
	<!-- dispatch //-->
	<div data-role="page" id="dispatch">
		<div data-role="header" data-position="fixed">
			<h1>White Rose Taxi</h1>
		</div>
		<div data-role="header" data-id="dispatch">
			<div data-role="navbar">
				<ul>
					<li><a href="#home">Home</a></li>					
					<li><a href="#jobs">Jobs</a></li>
					<li><a class="ui-btn-active ui-state-persist" href="#dispatch">Dispatch</a></li>
					<li><a href="#vehicles">Vehicles</a></li>
				</ul>
			</div><!-- /navbar -->
		</div>
		<div data-role="main" class="ui-content">
			<div style="text-align: center;">
				<img style="border-radius: 10px;" src="https://cdn.shopify.com/s/files/1/1490/7900/t/3/assets/WhiteRoseTaxiLogo.png" />
				<h1>Dispatch</h1>
			</div>
		</div>	
		<div data-role="footer" data-type="footer">
			<span style="padding: 2px;"> &nbsp;© 2018 White Rose Taxi</span>
			<span id="statusFooter" style="text-align: right; font-size: 10px;"></span>
		</div>
	</div>
	
	
	<!-- Vehicles //-->
	
	<div data-role="page" id="vehicles">
		<div data-role="header" data-position="fixed">
			<h1>White Rose Taxi</h1>
		</div>		<div data-role="header" data-id="vehicles">
			<div data-role="navbar">
				<ul>
					<li><a href="#home">Home</a></li>
					<li><a href="#jobs">Jobs</a></li>
					<li><a href="#dispatch">Dispatch</a></li>					
					<li><a class="ui-btn-active ui-state-persist" href="#vehicles">Vehicles</a></li>
				</ul>
			</div><!-- /navbar -->
		</div>
		<div data-role="main" class="ui-content">
			<div style="text-align: center;">
				<img style="border-radius: 10px;" src="https://cdn.shopify.com/s/files/1/1490/7900/t/3/assets/WhiteRoseTaxiLogo.png" />
				<h1>Vehicles</h1>
			</div>
		</div>	
		<div data-role="footer" data-type="footer">
			<span style="padding: 2px;"> &nbsp;© 2018 White Rose Taxi</span>
			<span id="statusFooter" style="text-align: right; font-size: 10px;"></span>
		</div>
	</div>
</body>
